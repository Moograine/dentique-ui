<div class="relative overflow-hidden w-full flex justify-content-center" #parentContainer>
  <div>
    <h1 class="text-white-alpha-80 text-center">{{ toothNotation[toothIndex] ? toothNotation[toothIndex].label : '' }}</h1>
    <!--  Add tooth name (like molar, premolar, incisor, etc)-->
    <img (dblclick)="addPreviousCare($event)"
         (touchstart)="onTouchStart($event)"
         class="w-18rem sm:w-20rem md:w-25rem lg:w-30rem" src="assets/images/tooth-molar.png">
    <div *ngIf="patientToothChart[toothIndex]">
      <div #previousCareLabel *ngFor="let previousCare of patientToothChart[toothIndex].previousCares; index as previousCareIndex"
           cdkDrag
           (cdkDragEnded)="dragEndedPreviousCare($event, previousCareIndex)"
           [cdkDragBoundary]="parentContainer"
           class="absolute flex line">
        <div class="hidden sm:block w-5rem md:w-8rem lg:w-14rem border-bottom-1 mt-1"></div>
        <div
          (click)="displayPreviousCareDialog(previousCareIndex)"
          class="label max-w-17rem border-bottom-1 p-1 sm:p-2
            border-round-top text-xs lg:text-base transition-duration-200 cursor-pointer">
          <span class="text-white-alpha-90">{{previousCare.treatment}}</span>
          <span *ngIf="previousCare.treatment.length && previousCare.date"
                class="text-white-alpha-70">: {{previousCare.date | date : 'YYYY-MM-dd'}}</span>
        </div>
      </div>
    </div>
    <div class="flex my-4 justify-content-center">
      <button pRipple (click)="closeToothDialog()" class="p-button font-medium">{{ 'button.close' | translate }}</button>
    </div>
  </div>
</div>

<p-dialog [modal]="true"
          [dismissableMask]="true"
          [resizable]="false"
          [autoZIndex]="false"
          [closeOnEscape]="true"
          class="previous-care-dialog"
          (onHide)="onDialogClose()"
          (keydown.control.enter)="closePreviousCareDialog()"
          [(visible)]="showPreviousCareDialog">
  <p class="m-1 text-sm text-white-alpha-70 w-75vw sm:w-20rem">{{ 'form.treatment' | translate }}:</p>
  <input (keyup.enter)="focusNextInput(dateInput)" #treatmentInput pInputText [(ngModel)]="previousCareToShow.treatment"/>
  <p class="m-1 pt-1 text-sm text-white-alpha-70">{{ 'form.date' | translate }}:</p>
  <p-calendar
    #dateInput
    (keyup.enter)="focusNextInput(descriptionInput)"
    [dateFormat]="'yy/mm/dd'"
    [(ngModel)]="previousCareToShow.date">
  </p-calendar>
  <p class="m-1 pt-1 text-sm text-white-alpha-70">{{ 'form.description' | translate }}</p>
  <textarea #descriptionInput pInputTextarea class="h-6rem" [(ngModel)]="previousCareToShow.description"></textarea>
  <div [class]="isNewPreviousCare ? 'justify-content-end' : 'justify-content-between'" class="flex mt-3">
    <button
      *ngIf="!isNewPreviousCare"
      pRipple
      type="button"
      (click)="deletePreviousCare()"
      class="p-button bg-transparent border-1 border-solid border-gray-700 hover:bg-gray-700 text-white-alpha-70 hover:text-white-alpha-90">
      <i class="pi pi-trash text-xl"></i>
    </button>
    <button pRipple type="button" (click)="closePreviousCareDialog()" class="p-button">Done</button>
  </div>
</p-dialog>

<p-toast></p-toast>
